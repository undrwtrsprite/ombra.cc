<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Color Picker â€” ombra tools</title>
  <link rel="stylesheet" href="/assets/styles/base.css" />
</head>
<body>
  <div class="bg-layer bg-gradient"></div>
  <div class="bg-layer bg-mesh"></div>
  <nav class="nav">
    <ul>
      <li><a href="/" class="logo">ombra</a></li>
      <li><a href="/index.html#tools">Tools</a></li>
    </ul>
  </nav>

  <main class="tool-container">
    <div class="tool-card reveal visible">
      <div class="tool-header">
        <div class="tool-icon">ðŸŽ¨</div>
        <h1>Color Picker</h1>
      </div>
      <div class="tool-body">
        <div class="control-row">
          <label>Upload Image</label>
          <input type="file" id="imageFile" accept="image/*" />
        </div>
        <div class="control-row">
          <label>Or use color picker</label>
          <input type="color" id="colorPicker" value="#6366f1" />
          <label>Format</label>
          <select id="format">
            <option value="hex">HEX</option>
            <option value="rgb">RGB</option>
            <option value="hsl">HSL</option>
            <option value="hsv">HSV</option>
          </select>
        </div>
        <div class="actions">
          <button class="btn-primary" id="extractColors">Extract from Image</button>
          <button class="btn-secondary" id="generatePalette">Generate Palette</button>
          <button class="btn-secondary" id="copyColor">Copy Color</button>
        </div>
        <div class="preview" id="preview">
          <canvas id="imageCanvas" style="display:none; max-width:100%; border-radius:12px;"></canvas>
          <div id="colorDisplay" style="display:flex; flex-direction:column; gap:16px; align-items:center;">
            <div id="currentColor" style="width:120px; height:120px; border-radius:16px; border:3px solid rgba(255,255,255,0.2);"></div>
            <div id="colorInfo" style="text-align:center;">
              <div style="font-size:18px; font-weight:600; margin-bottom:8px;">#6366f1</div>
              <div style="font-size:14px; color:#cbd5e1;">RGB: 99, 102, 241</div>
            </div>
          </div>
        </div>
        <div id="palette" style="display:none; margin-top:24px;">
          <h3 style="margin-bottom:16px; color:#ffffff;">Color Palette</h3>
          <div id="paletteColors" style="display:flex; gap:12px; flex-wrap:wrap;"></div>
        </div>
        <p class="note">Pick colors from images or use the color picker. All processing happens locally.</p>
      </div>
    </div>
  </main>

  <script src="/assets/scripts/effects.js"></script>
  <script>
    const imageFile = document.getElementById('imageFile');
    const colorPicker = document.getElementById('colorPicker');
    const format = document.getElementById('format');
    const extractBtn = document.getElementById('extractColors');
    const generateBtn = document.getElementById('generatePalette');
    const copyBtn = document.getElementById('copyColor');
    const preview = document.getElementById('preview');
    const imageCanvas = document.getElementById('imageCanvas');
    const colorDisplay = document.getElementById('colorDisplay');
    const currentColor = document.getElementById('currentColor');
    const colorInfo = document.getElementById('colorInfo');
    const palette = document.getElementById('palette');
    const paletteColors = document.getElementById('paletteColors');

    let currentColorValue = '#6366f1';

    function updateColorDisplay(color) {
      currentColorValue = color;
      currentColor.style.background = color;
      
      const hex = color;
      const r = parseInt(color.substr(1,2), 16);
      const g = parseInt(color.substr(3,2), 16);
      const b = parseInt(color.substr(5,2), 16);
      
      let displayText = '';
      switch(format.value) {
        case 'hex':
          displayText = hex.toUpperCase();
          break;
        case 'rgb':
          displayText = `RGB: ${r}, ${g}, ${b}`;
          break;
        case 'hsl':
          const hsl = rgbToHsl(r, g, b);
          displayText = `HSL: ${Math.round(hsl[0])}Â°, ${Math.round(hsl[1])}%, ${Math.round(hsl[2])}%`;
          break;
        case 'hsv':
          const hsv = rgbToHsv(r, g, b);
          displayText = `HSV: ${Math.round(hsv[0])}Â°, ${Math.round(hsv[1])}%, ${Math.round(hsv[2])}%`;
          break;
      }
      
      colorInfo.innerHTML = `
        <div style="font-size:18px; font-weight:600; margin-bottom:8px;">${displayText}</div>
        <div style="font-size:14px; color:#cbd5e1;">RGB: ${r}, ${g}, ${b}</div>
      `;
    }

    function rgbToHsl(r, g, b) {
      r /= 255; g /= 255; b /= 255;
      const max = Math.max(r, g, b), min = Math.min(r, g, b);
      let h, s, l = (max + min) / 2;

      if (max === min) {
        h = s = 0;
      } else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
          case r: h = (g - b) / d + (g < b ? 6 : 0); break;
          case g: h = (b - r) / d + 2; break;
          case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
      }
      return [h * 360, s * 100, l * 100];
    }

    function rgbToHsv(r, g, b) {
      r /= 255; g /= 255; b /= 255;
      const max = Math.max(r, g, b), min = Math.min(r, g, b);
      let h, s, v = max;
      const d = max - min;
      s = max === 0 ? 0 : d / max;

      if (max === min) {
        h = 0;
      } else {
        switch (max) {
          case r: h = (g - b) / d + (g < b ? 6 : 0); break;
          case g: h = (b - r) / d + 2; break;
          case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
      }
      return [h * 360, s * 100, v * 100];
    }

    function generatePalette(baseColor) {
      const r = parseInt(baseColor.substr(1,2), 16);
      const g = parseInt(baseColor.substr(3,2), 16);
      const b = parseInt(baseColor.substr(5,2), 16);
      
      const colors = [
        baseColor,
        `#${Math.round(r*0.8).toString(16).padStart(2,'0')}${Math.round(g*0.8).toString(16).padStart(2,'0')}${Math.round(b*0.8).toString(16).padStart(2,'0')}`,
        `#${Math.round(r*0.6).toString(16).padStart(2,'0')}${Math.round(g*0.6).toString(16).padStart(2,'0')}${Math.round(b*0.6).toString(16).padStart(2,'0')}`,
        `#${Math.round(r*1.2).toString(16).padStart(2,'0')}${Math.round(g*1.2).toString(16).padStart(2,'0')}${Math.round(b*1.2).toString(16).padStart(2,'0')}`,
        `#${Math.round(r*1.4).toString(16).padStart(2,'0')}${Math.round(g*1.4).toString(16).padStart(2,'0')}${Math.round(b*1.4).toString(16).padStart(2,'0')}`
      ];
      
      paletteColors.innerHTML = colors.map(color => `
        <div style="display:flex; flex-direction:column; align-items:center; gap:8px;">
          <div style="width:60px; height:60px; background:${color}; border-radius:12px; border:2px solid rgba(255,255,255,0.2);"></div>
          <div style="font-size:12px; color:#cbd5e1;">${color.toUpperCase()}</div>
        </div>
      `).join('');
      
      palette.style.display = 'block';
    }

    colorPicker.addEventListener('input', (e) => {
      updateColorDisplay(e.target.value);
    });

    format.addEventListener('change', () => {
      updateColorDisplay(currentColorValue);
    });

    extractBtn.addEventListener('click', () => {
      const file = imageFile.files[0];
      if (!file) {
        alert('Please select an image first');
        return;
      }
      
      const img = new Image();
      img.onload = () => {
        const canvas = imageCanvas;
        canvas.width = img.width;
        canvas.height = img.height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);
        
        canvas.style.display = 'block';
        colorDisplay.style.display = 'none';
        
        canvas.addEventListener('click', (e) => {
          const rect = canvas.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          const pixel = ctx.getImageData(x, y, 1, 1).data;
          const color = `#${pixel[0].toString(16).padStart(2,'0')}${pixel[1].toString(16).padStart(2,'0')}${pixel[2].toString(16).padStart(2,'0')}`;
          updateColorDisplay(color);
          colorPicker.value = color;
        });
      };
      img.src = URL.createObjectURL(file);
    });

    generateBtn.addEventListener('click', () => {
      generatePalette(currentColorValue);
    });

    copyBtn.addEventListener('click', async () => {
      await navigator.clipboard.writeText(currentColorValue);
    });

    updateColorDisplay('#6366f1');
  </script>
</body>
</html>
