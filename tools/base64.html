<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Base64 Encoder/Decoder ‚Äî ombra tools</title>
  <meta name="description" content="Encode/decode text and files to/from Base64 locally in your browser." />
  <link rel="stylesheet" href="/assets/styles/base.css" />
</head>
<body>
  <div class="bg-layer bg-gradient"></div>
  <div class="bg-layer bg-mesh"></div>
  <nav class="nav">
    <ul>
      <li><a href="/" class="logo">ombra</a></li>
      <li><a href="/index.html#tools">Tools</a></li>
    </ul>
  </nav>

  <main class="tool-container">
    <div class="tool-card reveal visible">
      <div class="tool-header">
        <div class="tool-icon">üß¨</div>
        <h1>Base64 Encoder/Decoder</h1>
      </div>
      <div class="tool-body">
        <div class="toolbar" role="toolbar" aria-label="Base64 Encoder/Decoder">
          <span class="spacer"></span>
          <button class="btn-primary" id="encodeBtn">Encode ‚Üí</button>
          <button class="btn-secondary" id="decodeBtn">‚Üê Decode</button>
          <button class="btn-secondary" id="copyBtn">Copy Output</button>
        </div>
        <div class="control-row">
          <label>Text</label>
          <textarea id="text" placeholder="Enter text or Base64"></textarea>
        </div>
        <div class="result" id="outputBox" style="margin-top:12px;">
          <h3>Output</h3>
          <div id="output" style="word-break:break-all;"></div>
        </div>

        <div class="control-row" style="margin-top:16px;">
          <label>File ‚Üí Base64</label>
          <input type="file" id="fileInput" />
          <button class="btn-secondary" id="fileToB64Btn">Convert</button>
        </div>
        <div class="control-row">
          <label>Base64 ‚Üí File</label>
          <input type="text" id="fileName" placeholder="output.bin" />
          <button class="btn-secondary" id="b64ToFileBtn">Download</button>
        </div>
        <div id="errorMessage" style="display:none;background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);border-radius:8px;padding:12px;margin-top:16px;color:#ef4444;"></div>
        <p class="note">Processing is done locally. Large files may take longer.</p>
      </div>
    </div>
  </main>

    
  <!-- Service Worker Registration for offline support -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(registration => {
            console.log('Service Worker registered successfully:', registration.scope);
          })
          .catch(error => {
            console.log('Service Worker registration failed:', error);
          });
      });
    }
  </script>
  <script src="/assets/scripts/tool-performance.js"></script>
  <script src="/assets/scripts/effects.js"></script>
  <script src="/assets/scripts/back-button.js"></script>
  <script>
    const textArea = document.getElementById('text');
    const output = document.getElementById('output');
    const encodeBtn = document.getElementById('encodeBtn');
    const decodeBtn = document.getElementById('decodeBtn');
    const copyBtn = document.getElementById('copyBtn');
    const fileInput = document.getElementById('fileInput');
    const fileToB64Btn = document.getElementById('fileToB64Btn');
    const fileNameInput = document.getElementById('fileName');
    const b64ToFileBtn = document.getElementById('b64ToFileBtn');
    const errorMessage = document.getElementById('errorMessage');

    function showError(msg) {
      errorMessage.textContent = msg;
      errorMessage.style.display = 'block';
      setTimeout(() => { errorMessage.style.display = 'none'; }, 5000);
    }

    function setOutput(text) { output.textContent = text; }

    // Optimize button clicks with RAF and prevent double-clicks
    encodeBtn.addEventListener('click', () => {
      rafUpdate(() => {
        try {
          const encoded = btoa(unescape(encodeURIComponent(textArea.value)));
          setOutput(encoded);
        } catch {
          setOutput('Encoding failed.');
        }
      });
    });

    decodeBtn.addEventListener('click', () => {
      rafUpdate(() => {
        try {
          const decoded = decodeURIComponent(escape(atob(textArea.value.replace(/\s+/g, ''))));
          setOutput(decoded);
        } catch {
          setOutput('Decoding failed. Ensure valid Base64.');
        }
      });
    });

    copyBtn.addEventListener('click', async () => {
      try { 
        await navigator.clipboard.writeText(output.textContent || ''); 
      } catch {}
    });

    fileToB64Btn.addEventListener('click', async () => {
      const file = fileInput.files && fileInput.files[0];
      if (!file) return;
      
      setButtonLoading(fileToB64Btn, true, 'Convert');
      
      try {
        const buffer = await file.arrayBuffer();
        const bytes = new Uint8Array(buffer);
        let binary = '';
        
        // Chunk large files for better performance
        const chunkSize = 10000;
        for (let i = 0; i < bytes.length; i += chunkSize) {
          const chunk = bytes.slice(i, i + chunkSize);
          for (let j = 0; j < chunk.length; j++) {
            binary += String.fromCharCode(chunk[j]);
          }
          // Yield to browser for large files
          if (i % (chunkSize * 10) === 0) {
            await new Promise(resolve => rafUpdate(resolve));
          }
        }
        
        rafUpdate(() => setOutput(btoa(binary)));
      } finally {
        setButtonLoading(fileToB64Btn, false);
      }
    });

    b64ToFileBtn.addEventListener('click', () => {
      const base64 = textArea.value.replace(/\s+/g, '');
      if (!base64) {
        showError('Please enter Base64 data to decode');
        return;
      }
      try {
        const binary = atob(base64);
        const len = binary.length;
        const bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) bytes[i] = binary.charCodeAt(i);
        const blob = new Blob([bytes], { type: 'application/octet-stream' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = fileNameInput.value || 'output.bin'; a.click();
        URL.revokeObjectURL(url);
        errorMessage.style.display = 'none';
      } catch {
        showError('Invalid Base64 input. Please ensure the input is valid Base64 encoded data.');
      }
    });
  </script>
</body>
</html>


